<HTML><HEAD>
<TITLE>Randomise</TITLE>
</HEAD><BODY BACKGROUND="../images/fsl-bg.jpg">
<hr><TABLE BORDER=0 WIDTH="100%"><TR>
<TD ALIGN=CENTER><H1>Randomise</H1>
<H3>Permutation-based nonparametric inference<br>
developed in collaboration with Thomas Nichols, University of Michigan Biostatistics</H3>
<TD ALIGN=RIGHT><a href="../index.html"><IMG BORDER=0 SRC="../images/fsl-logo.jpg"></a>
</TR></TABLE>


<HR><H2>INTRODUCTION</H2>

<p>Permutation methods (also known as randomisation methods) are used
for inference (thresholding) on statistic maps when the null
distribution is not known.  The null distribution is unknown because
either the noise in the data does not follow a simple distribution, or
because the analysis carried out means that that it is not possible to
analytically predict the null distribution in the final statistic
image.

<b>randomise</b> is a simple permutation program enabling modelling
and inference using standard GLM design setup as used for example in
FEAT. It can output voxelwise and cluster-based tests, and also
offers variance smoothing as an option.  

<p>Warning: randomise is a beta-release program that has not been
extensively tested yet!

<P><b>randomise</b> implements a Monte Carlo permutation test, where
permutations of the data are randomly generated.  This will produce
almost identical results to an exhaustive permutation test, where the
data is systematically permuted.

<p>For more detail on permutation testing see <i>TE Nichols and AP
Holmes. Nonparametric Permutation Tests for Functional Neuroimaging: A
Primer with Examples. Human Brain Mapping, 15:1-25, 2002</i>.

<HR><H2>randomise</H2>

<p>A typical simple call to <b>randomise</b> uses the following syntax:<br><code>
randomise -i &lt;4D_input_data&gt; -o &lt;output_rootname&gt; -d design.mat -t
design.con -m &lt;mask_image&gt; -n 5000 -D</code><br>

<code>design.mat</code> and <code>design.con</code> are text files
containing the design matrix and list of contrasts required; they
follow the same format as generated by FEAT (see below for
example). The <code>-n 5000</code> option tells randomise to generate
5000 different permutations of the data when building up the null
distribution to test against. The <code>-D</code> option tells
randomise to demean the data before continuing - this is necessary
(for example for FMRI time series data) if you are not modelling the
mean in the design matrix.

<p>randomise outputs the following thresholding options:

<UL>

  <LI> Voxel-based thresholding uncorrected for multiple
  comparisons: &lt;output&gt;_vox_tstat

  <LI> Voxel-based thresholding corrected for multiple comparisons by
  using the null distribution of the max (across the image) test
  statistic: &lt;output&gt;_max_tstat

  <LI> Cluster-based thresholding corrected for multiple comparisons
  by using the null distribution of the max (across the image) cluster
  size: &lt;output&gt;_maxc_tstat<br>To use this option, use <code>-c
  &lt;c_thresh&gt;</code>, where the threshold is used to form
  supra-threshold clusters of voxels.
  
</UL>

These output images are p-value images from 0:1 where 1 is most
significant (arranged this way to make display and thresholding
simple). Thus to "threshold at p<0.01", threshold the output images at
0.99 etc.

<p>If you have "confound regressors", randomise needs those to be
removed before continuing. Therefore, unlike with FEAT, you need to
specify these as a separate design matrix and use the <code>-x</code>
option when calling randomise; randomise then regresses these out of
the data before continuing. Note that for this to make sense, your
confounds and design of interest need to be orthogonal. In fact, in
general in randomise, your regressors should be orthogonal to each
other.

<p>If your design is simply all 1s (for example, a single group of
subjects) then randomise needs to work in a different way. Normally it
generates random samples by randomly permuting the rows of the design;
however in this case it does so by randomly inverting the sign of the
1s. In this case, then, instead of specifying design and contrast
matrices on the command line, use the <code>-1</code> option.

<p>You can potentially improve the estimation of the variance that
feeds into the final "t" statistic image by using the variance
smoothing option <code>-v &lt;std&gt;</code> where you need to specify
the spatial extent of the smoothing in mm.

<p>There are two programs that make it easy to create the design
matrix and contrast files <code>design.mat / design.con</code>. The
first is the GUI <code>Glm</code> which allows the specification of
designs in the same way as in FEAT, and the second is a simple script
to allow you to easily generate design files for the two-group
unpaired t-test case, called <code>design_ttest2</code>.

<hr><p><b>Example: One-Sample T-test.</b>

<p>To perform a nonparametric 1-sample t-test on, say, COPEs, create
a 4D image of all of the images.  There should be no repeated measures,
i.e., there should only be one image per subject. Because this is a
single group simple design you don't need a design matrix or contrasts
setup. Just use:<BR>

<code>randomise -i OneSamp4D -o OneSampT -1</code><br>

Note you do not need the <code>-D</code> option (as the mean is in the
model), and omit the <code>-n</code> option, so that 5000 permutations
will be performed.

<P>If you have fewer than 20 subjects (approx. 20 DF), then you will
usually see an increase in power by using variance smoothing, as in

<BR><code>randomise -i OneSamp4D -o OneSampT -1 -v 10</code><br>

which does a 10 mm HWHM variance smoothing.  

<hr><p><b>Example: Two-Sample Unpaired T-test.</b>

<p> To perform a nonparametric 2-sample t-test on, say, COPEs, create
4D image of all of the images, with the subjects in the right order!
Create appropriate <a href="design.mat">design.mat</a> and <a
href="design.con">design.con</a> files.

<P>Once you have your design files run:

<BR><code>
randomise -i TwoSamp4D -o TwoSampT -d design.mat -t design.con -m mask
</code><br>


<p><HR><FONT SIZE=1>Copyright &copy; 2004, University of
Oxford. Written by <A
HREF="http://www.fmrib.ox.ac.uk/~behrens/index.html">T. Behrens</A>, <A
HREF="http://www.fmrib.ox.ac.uk/~steve/index.html">S. Smith</A> and <A
HREF="http://www.sph.umich.edu/~nichols">T. Nichols</A>.</FONT>

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

</BODY></HTML>

